import pandas as pd
import numpy as np
from datetime import datetime, timedelta

np.random.seed(42)

n = 600

agentes = {
    "AG01": {"nombre": "Carlos Mendez",    "experiencia_meses": 36},
    "AG02": {"nombre": "Laura Rios",       "experiencia_meses": 24},
    "AG03": {"nombre": "Jorge Castillo",   "experiencia_meses": 6},
    "AG04": {"nombre": "Valentina Cruz",   "experiencia_meses": 18},
    "AG05": {"nombre": "Andres Morales",   "experiencia_meses": 48},
    "AG06": {"nombre": "Sofia Herrera",    "experiencia_meses": 12},
    "AG07": {"nombre": "Miguel Torres",    "experiencia_meses": 30},
    "AG08": {"nombre": "Daniela Vargas",   "experiencia_meses": 3},
}

categorias_llamada = ["Venta Nueva", "Renovacion", "Queja", "Soporte Tecnico", "Cancelacion"]
turnos = ["Manana", "Tarde", "Noche"]

fecha_inicio = datetime(2024, 1, 1)
fechas = [fecha_inicio + timedelta(days=np.random.randint(0, 365)) for _ in range(n)]
dia_semana = [f.weekday() for f in fechas]
mes = [f.month for f in fechas]

ids_agentes = np.random.choice(list(agentes.keys()), n)
nombres_agentes = [agentes[a]["nombre"] for a in ids_agentes]
experiencia = [agentes[a]["experiencia_meses"] for a in ids_agentes]

turno_asignado = np.random.choice(turnos, n, p=[0.45, 0.40, 0.15])

llamadas_base = np.random.randint(10, 30, n)
bonus_dia = np.where(np.isin(dia_semana, [0, 4]), np.random.randint(4, 9, n), 0)
llamadas_por_turno = llamadas_base + bonus_dia
bonus_diciembre = np.where(np.array(mes) == 12, np.random.randint(3, 7, n), 0)
llamadas_por_turno = llamadas_por_turno + bonus_diciembre

categoria_llamada = np.random.choice(categorias_llamada, n, p=[0.30, 0.25, 0.15, 0.20, 0.10])

duracion_base = np.random.normal(8, 2, n)
bonus_cancelacion = np.where(categoria_llamada == "Cancelacion", np.random.uniform(5, 10, n), 0)
duracion_promedio = np.clip(duracion_base + bonus_cancelacion, 3, 25).round(1)

score_base = 5 + (duracion_promedio * 0.15) + (np.array(experiencia) * 0.03)
ruido = np.random.normal(0, 0.8, n)
penalizacion_saturacion = np.where(llamadas_por_turno > 25, -1.2, 0)
penalizacion_cancelacion = np.where(categoria_llamada == "Cancelacion", -1.5, 0)
penalizacion_noche_marzo = np.where(
    (np.array(turno_asignado) == "Noche") & (np.array(mes) == 3), -2.0, 0
)
score_satisfaccion = np.clip(
    score_base + ruido + penalizacion_saturacion + penalizacion_cancelacion + penalizacion_noche_marzo,
    1, 10
).round(1)

score_qa_base = 60 + (np.array(experiencia) * 0.5) + np.random.normal(0, 8, n)
penalizacion_qa_saturacion = np.where(llamadas_por_turno > 25, -8, 0)
score_qa = np.clip(score_qa_base + penalizacion_qa_saturacion, 40, 100).round(1)

tasa_error_base = np.clip(20 - (np.array(experiencia) * 0.2) + np.random.normal(0, 3, n), 2, 40)
tasa_error = np.where(ids_agentes == "AG04", tasa_error_base * 1.8, tasa_error_base).round(1)

prob_resolucion = np.clip(0.4 + (np.array(experiencia) * 0.01), 0.4, 0.85)
resolucion_primera = np.array(
    [np.random.choice(["Si", "No"], p=[p, 1-p]) for p in prob_resolucion]
)

dias_nombres = ["Lun", "Mar", "Mie", "Jue", "Vie", "Sab", "Dom"]

df = pd.DataFrame({
    "fecha":                 [f.strftime("%Y-%m-%d") for f in fechas],
    "mes":                   mes,
    "dia_semana":            [dias_nombres[d] for d in dia_semana],
    "id_agente":             ids_agentes,
    "nombre_agente":         nombres_agentes,
    "experiencia_meses":     experiencia,
    "turno":                 turno_asignado,
    "categoria_llamada":     categoria_llamada,
    "llamadas_por_turno":    llamadas_por_turno,
    "duracion_promedio_min": duracion_promedio,
    "score_satisfaccion":    score_satisfaccion,
    "score_qa":              score_qa,
    "tasa_error_pct":        tasa_error,
    "resolucion_primera":    resolucion_primera,
})

df.to_csv("call_center_data.csv", index=False)
print(f"CSV generado con {len(df)} registros y {len(df.columns)} columnas.")
print(df.head())
